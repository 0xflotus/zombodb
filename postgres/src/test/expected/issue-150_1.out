SELECT *
FROM zdb_json_aggregate('so_posts', '{
        "top-tags": {
            "terms": {
                "field": "tags",
                "size": 3
            },
            "aggs": {
                "top_tag_hits": {
                    "top_hits": {
                        "sort": [
                            {
                                "last_activity_date": {
                                    "order": "desc"
                                }
                            }
                        ],
                        "size" : 1
                    }
                }
            }
        }
    }', 'java');
                                                                                                                                                                                                                                                                                                                                                                                                                 zdb_json_aggregate                                                                                                                                                                                                                                                                                                                                                                                                                  
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 {"top-tags":{"doc_count_error_upper_bound":136,"sum_other_doc_count":13143,"buckets":[{"key":"java","doc_count":2713,"top_tag_hits":{"hits":{"total":2713,"max_score":null,"hits":[{"_index":"contrib_regression.public.so_posts.idxso_posts","_type":"data","_id":"19489-5","_score":null,"sort":["2015-03-07T20:40:16.6-08:00"]}]}}},{"key":"design","doc_count":695,"top_tag_hits":{"hits":{"total":695,"max_score":null,"hits":[{"_index":"contrib_regression.public.so_posts.idxso_posts","_type":"data","_id":"19250-3","_score":null,"sort":["2015-03-05T21:44:49.017-08:00"]}]}}},{"key":"programming","doc_count":528,"top_tag_hits":{"hits":{"total":528,"max_score":null,"hits":[{"_index":"contrib_regression.public.so_posts.idxso_posts","_type":"data","_id":"19471-4","_score":null,"sort":["2015-03-07T05:25:36.45-08:00"]}]}}}]}}
(1 row)

